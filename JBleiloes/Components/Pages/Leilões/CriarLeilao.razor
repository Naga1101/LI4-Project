@page "/criarleilao"
@using JBleiloes.data
@using JBleiloes.data.Utilizadores
@rendermode InteractiveServer
@inject NavigationManager NavigationManager

<PageTitle>Criar Leilão</PageTitle>

<div class="container">
    <form class="inputs">
        <div class="column">
            <h3>Dados do Veículo</h3>
            <div class="form-group">
                <label for="Marca">Marca:</label>
                <input id="Marca" @bind="Marca" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Modelo">Modelo:</label>
                <input id="Modelo" @bind="Modelo" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Ano">Ano:</label>
                <input id="Ano" @bind="Ano" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Descrição">Descrição:</label>
                <input id="Descrição" @bind="Descricao" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Quilometragem">Quilometragem:</label>
                <input id="Quilometragem" @bind="Quilometragem" class="form-control" required />
            </div>
        </div>

        <div class="column">
            <h3>Informações de Leilão</h3>
            <div class="form-group">
                <label for="Valor Inicial">Valor Inicial:</label>
                <input id="Valor Inicial" @bind="valor_inicial" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Valor Mínimo de Licitação">Valor Mínimo de Licitação:</label>
                <input id="Valor Mínimo de Licitação" @bind="valor_minimo" class="form-control" required />
            </div>
            <div class="form-group">
                <label for="Tempo de Leilão ex:2000-10-10">Tempo de Leilão ex:2000-10-10:</label>
                <input id="Tempo de Leilão ex:2000-10-10" @bind="tempo_de_leilao" class="form-control" required />
            </div>
        </div>

        <div class="column">
            <h3>Imagens</h3>
            <div class="input-group">
                <input type="file" accept="image/*" multiple @onchange="UpdateButton" />
            </div>
            <div class="input-group">
                <input type="file" accept="image/*" multiple @onchange="UpdateButton" />
            </div>
            <button type="button" class="finalize-button enabled" @onclick="registo">Finalizar Lista</button>
        </div>
    </form>
            @*
        <div class="input-group">
            @if (!@ativar)
            {
                <button type="button" class="finalize-button enabled" @onclick="registo" @onmouseover="UpdateButton" @onmousemove="UpdateButton" @onmouseleave="UpdateButton">Finalizar Lista</button>
            }
            else
            {
                <button type="button" class="finalize-button disabled" @onmouseover="UpdateButton" @onmousemove="UpdateButton" @onmouseleave="UpdateButton">Finalizar Lista</button>
            }
            </div>*@
</div>

<style>
    .container {
        display: flex;
        justify-content: space-between;
        margin: 20px;
    }

    .column {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 0 10px;
    }

    .input-group {
        margin-bottom: 10px;
    }

    input {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
    }

    .finalize-button {
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

        .finalize-button.enabled {
            background-color: #4CAF50;
            color: white;
        }

        .finalize-button.disabled {
            background-color: #ccc;
            color: #666;
            cursor: not-allowed;
        }
</style>


@code {

    public int id { get; private set; }
    public string titulo { get; private set; }
    public decimal valor_inicial { get; private set; }
    public string vendedor { get; private set; }
    public decimal valor_minimo { get; private set; }
    public decimal valor_atual { get; private set; }
    public string tempo_de_leilao { get; private set; }
    public string? imagem { get; private set; }
    public string Marca { get; private set; }
    public string Modelo { get; private set; }
    public string Descricao { get; private set; }
    public int Ano { get; private set; }
    public decimal Quilometragem { get; private set; }

    private bool ativar = false;

    private bool CanFinalizeListing()
    {
        // Check if all required fields (except images) are filled
        return !string.IsNullOrEmpty(titulo)
               && valor_inicial > 0
               && !string.IsNullOrEmpty(SessionUser.getSessionUser().username)
               && valor_minimo > 0
               && !string.IsNullOrEmpty(tempo_de_leilao)
               && !string.IsNullOrEmpty(Marca)
               && !string.IsNullOrEmpty(Modelo)
               && Ano > 0
               && Quilometragem > 0;
    }

    private void UpdateButton()
    {
        ativar = CanFinalizeListing(); // Trigger a re-render to update the button style
        StateHasChanged();
    }

    private void registo()
    {
        if (CanFinalizeListing())
        {
            TimeSpan tempo = TimeSpan.Parse(tempo_de_leilao);
            JBLeiloes jb = new JBLeiloes();
            jb.registaLeilaoEveiculo(titulo, valor_inicial, SessionUser.getSessionUser().username, valor_minimo, tempo, Marca, Modelo, Ano, Quilometragem);
            NavigationManager.NavigateTo("/meuslotes");
        }
    }
}