@page "/leilao/{id}"
@using JBleiloes.data.Utilizadores
@using JBleiloes.Components.Layout
@using JBleiloes.data.Leiloes
@using JBleiloes.data
@layout MainLayout
@rendermode InteractiveServer
@inject NavigationManager NavigationManager

<div class="title">
    <h1>@leilao.titulo</h1>
</div>

<div class="container">
    <div class="left">
        <h2>Images</h2>
        <!-- Placeholder content, you can add images here later -->
        <img src="https://via.placeholder.com/150" alt="Placeholder Image 1">
        <img src="https://via.placeholder.com/150" alt="Placeholder Image 2">
        <img src="https://via.placeholder.com/150" alt="Placeholder Image 3">
    </div>
    <div class="right">
        <form>
            <h3>Valor inicial @leilao.valor_inicial</h3>
            <p>Lance atual: @leilao.valor_atual</p>
            <p>Termina em @leilao.tempo_de_leilao</p>

            @if (jb.getUtilizador(leilao.vendedor).username != SessionUser.getSessionUser().username)
            {
            <label for="inputField">Sua Licitação:</label>
            <input type="text" id="inputField" name="inputField" />

            <button type="submit">Confirmar Licitação</button>
                <div class="bottom-left">
                    @if (addedToWatchlist)
                    {
                        <button type="button" class="rmWatchlist-button" @onclick="() => removerWatchlist(SessionUser.getSessionUser().username, leilao.id)"> Remover da Watchlist </button>
                    }
                    @if (!addedToWatchlist)
                    {
                        <button type="button" class="addWatchlist-button" @onclick="() => adicionarWatchlist(SessionUser.getSessionUser().username, leilao.id)"> Adicionar à Watchlist </button>
                    }
                </div>
            }
            <div class="bottom-right">
                <p>Sold by: @vendedor</p>
            </div>
        </form>
    </div>
</div>

<style>
    .title {
        text-align: center;
        margin-bottom: 20px;
    }

    .container {
        display: flex;
    }

    .left {
        flex: 1;
        padding: 20px;
    }

    .right {
        flex: 1;
        padding: 20px;
        border: 1px solid #ccc;
        margin-left: 20px;
        position: relative;
    }

    .bottom-left {
        position: absolute;
        bottom: 20px;
        left: 20px;
    }

    .addWatchlist-button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .rmWatchlist-button {
        background-color: #FF0000; /* Red color */
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .bottom-right {
        position: absolute;
        bottom: 20px;
        right: 20px;
    }
</style>

@code {
    [Parameter]
    public string id { get; set; }

    private string? vendedor = null;
    private bool addedToWatchlist = false;

    private Utilizador? user = @SessionUser.getSessionUser();

    private Leilao leilao;

    JBLeiloes jb = new JBLeiloes();

    protected override void OnInitialized()
    {
        if (int.TryParse(id, out int ident))
        {
            leilao = jb.getLeilaoId(ident);
            vendedor = jb.getUtilizador(leilao.vendedor).nome;
            addedToWatchlist = jb.podeAdicionarWatchList(SessionUser.getSessionUser().username, leilao.id);
        }
        else
        {

        }
    }

    private void adicionarWatchlist(string username, int idLeilao)
    {
        jb.AdicionarWatchlist(username, idLeilao);
        addedToWatchlist = !addedToWatchlist;
    }
    private void removerWatchlist(string username, int idLeilao)
    {
        jb.removerWatchlist(username, idLeilao);
        addedToWatchlist = !addedToWatchlist;
    }
}
